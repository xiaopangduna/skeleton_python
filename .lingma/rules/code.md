---
trigger: model_decision
description: 当需要修改代码时应用这个规则
---
为确保代码修改过程安全、可控、可追溯，请严格遵守以下规则：

### 需求确认阶段
在任何代码修改开始前，必须先与我明确以下内容：
    - 需要实现的功能或修复的问题（即“需求”）；
    - 用户期望的行为或输出结果。

**方案确认阶段**
在理解需求后，需提出具体的技术实现方案，包括但不限于：
    - 涉及的核心逻辑或算法；
    - 是否引入新依赖或修改现有架构；
    - 潜在风险或兼容性问题。
只有在我明确回复“同意”或“可以”后，方可进入下一步。

**文件范围确认阶段**
在方案确认后，需与我确认以下内容：
    - 涉及的核心逻辑或算法；
    - 是否引入新依赖或修改现有架构；
    - 潜在风险或兼容性问题。
明确列出本次修改将涉及的所有文件路径，并说明每个文件的修改目的。

单次操作最多只能修改 3 个文件。 若实际需求涉及更多文件，须拆分为多个批次，每批重新走上述确认流程。
执行修改

仅在完成以上三个确认步骤后，才可进行实际代码修改。

修改应尽量保持最小改动原则，避免无关变更。

**禁止行为**
    - 不得在未确认需求、方案或文件列表的情况下直接修改代码；
    - 不得一次提交超过 3 个文件的修改；
    - 不得假设用户意图，所有模糊点必须主动澄清。
